---
title: "あとがき"
---

これまで私はここまでの分量の文章を体系的に書き留めたことがなく、実際書いてみて章構成も拙さを感じます。同じことをあっちこっちで書いて言いたいことが散逸してしまったように思いますが、これをさらに再構成する気力はもうないです。しかし、本当に伝わってほしいことは伝わったのではないでしょうか。

実はこれだけReact的思想を述べておきながら私はReactを直接さわったことはなく、Haskellも概念の触りだけをむしろこれを書くために学びました。これまでなんとなくこうではないか？とぼんやりとした考えを、より数理理論的に説明してくれるツールが、純粋関数的パラダイムであり、HaskellやReactでした。そもそもこれってなんだっけというところからの思想です。

flutter_hooksやRiverpodから逆流するようにReactの思想を知ることで、Riverpodなき`useEffect`はいや確かにそれはカオスにならざるをえないとか、そんなことも感じるようになりましたし、Riverpodがより緻密に設計されたライブラリであったことを再評価するきっかけにもなりました。

一方、随所に感じられるある意味呪詛とも取れる、C#やPHPの参照渡しが壊すとか、DialogFragmentの反省を明確に受け継ぐJetpack ComposeのDialogとか、ViewModelの肥大化に対する批判とか、それらは明確に私自身のこれまでの経験への批判や疑問から成り立っています。これは別フレームワークだけでなく、Flutterの命令的操作に対する批判すら含まれていますし、RiverpodのProvider粒度論についてもそうです。これまでの様々な過ちや誤解に対してなぜ、を突き詰めた結果をたくさん盛り込めたつもりでいます。

これまでFlutterとRiverpodでどうあるべきか、なぜ[riverpod.dev](https://riverpod.dev/)のサンプルコードにあるようなコードを誰も書かないのだろうということも考えてきました。

```dart
@riverpod
Future<String> boredSuggestion(Ref ref) async {
  final response = await http.get(
    Uri.https('boredapi.com', '/api/activity'),
  );
  final json = jsonDecode(response.body) as Map;
  return json['activity']! as String;
}
```

よくよく考えたら不思議ですね。Riverpodは誰もRiverpodのドキュメントのようには書かず、使う者はなんとかViewModelとかなんとかUseCaseとかなんとかRepositoryに、オブジェクト指向的に集約しようとします。これは冷静に立ち返ってみれば何でなんだっけ、となりました。ChatGPTにも禅問答をたくさん繰り返しました。

本稿を書きながら、ようやく多くの人はクリーンアーキテクチャをUseCaseとPresenterとViewModelだかControllerだかの層に定式化しようとしているのは、根本的にクリーンアーキテクチャの捉え方が誤っている、またはスマホアプリ開発を背景に持つ多くの人は、それは過去の私も当然、Reactの背景を持たないのだから原子的状態管理に行き着かないのではないかという結論に至りました。なんとなくそういうことができそうという車輪の再発明のしかかりはあっても、RiverpodはJotaiやRecoilではないので、結局行き着かなかったのです。

私自身が画面本位主義やViewModelがRiverpodの本質を見ていないと感じたときはいくつかあります。Riverpodがまだ未成熟の頃のFlutterプロジェクトにおいて、大量の引数を持つウィジェットが誰も管理できないような形でのさばっているのを見たときでもありますし、一番大きいのは拙作のFlutterアプリの**フォーク**である[Aria](https://github.com/poppingmoon/aria)のソースを見たときでした。初めて見たとき、自分のアプリのフォークに設計思想の根本的欠陥を指摘されたような心持ちすらありました。そのうちの一部は現在はAriaの作者の、Ariaが登場する前の拙作Miriaに対するプルリクエストに現れていましたが、その本質を私が理解するのはフォークとして別のアプリとして枝分かれし、Riverpodの使い方をほとんどゼロベースで再構築されたのを見たそのときでした。



私にこれまで様々な洞察の機会を与えてくれたこれまでのプロジェクトの方々や、Miriaを使ってくれているユーザーの方々、そして何よりコペルニクス的転回をもたらしてくれたAriaの作者のpoppingmoon氏に謝辞を送りたいと思います。

そしてこれを読んだ方が、何かしらFlutterやRiverpodの設計思想の哲学的再評価が行えるきっかけになったらなと思います。あるいはFlutter&Riverpodでなくても、Vue.jsでもJetpack Composeでもなんでもいいですが、宣言型UIに対する何かしらの洞察が生まれたなら幸いです。

